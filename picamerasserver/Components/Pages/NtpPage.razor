@page "/ntp"
@using picamerasserver.Components.Components

<DefaultPage>
    <MudStack Style="width: 100%">
        <MudExpansionPanels Elevation="5" MultiExpansion>
            <MudExpansionPanel Expanded Gutters="false" Dense="true">
                <TitleContent>
                    <MudText Typo="Typo.h5">NTP Sync</MudText>
                </TitleContent>
                <ChildContent>
                    <StatusTable ColorTransform="@ColorTransform" TooltipTransform="@_tooltipTransform"></StatusTable>
                    <MudStack Row="true" Spacing="4" Class="pa-4" AlignItems="AlignItems.Center">
                        <MudButton Variant="Variant.Filled" Color="Color.Primary"
                                   OnClick="@RequestNtpSyncStep">
                            Big (step)
                        </MudButton>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary"
                                   OnClick="@RequestNtpSyncSlew">
                            Small (slew)
                        </MudButton>
                    </MudStack>
                    <MudStack Spacing="4" Class="pa-4" AlignItems="AlignItems.Start">
                        <MudText Typo="Typo.h6">Offset</MudText>
                        <MudText Typo="Typo.body2">Min @MinOffset ms/Max @MaxOffset ms</MudText>
                        <MudText Typo="Typo.h6">Error</MudText>
                        <MudText Typo="Typo.body2"> Min @MinError ms/Max @MaxError ms</MudText>
                    </MudStack>
                </ChildContent>
            </MudExpansionPanel>
        </MudExpansionPanels>
    </MudStack>
</DefaultPage>

@code {
    private Func<string, RenderFragment?> _tooltipTransform = _ => null;

    private void UpdateTooltipTransform()
    {
        _tooltipTransform = cameraId =>
        {
            var item = PiZeroCameraManager.PiZeroCameras[cameraId];

            return @<NtpRequestTooltip PiZeroCamera="item"/>;
        };
    }

}