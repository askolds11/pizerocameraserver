@page "/NewPicturePage/{uuid:guid?}"
@using picamerasserver.Components.Components
@using picamerasserver.Components.Components.NewPicture
@using picamerasserver.Database.Models

<PageTitle>New picture set - PiCam</PageTitle>
<DefaultPage>
    <MudStack Style="width: 100%" Class="pb-4 mb-20">
        <MudExpansionPanels Elevation="5" MultiExpansion>
            <MudStack Spacing="4">
                <MudExpansionPanel Expanded>
                    <TitleContent>
                        <MudText Typo="Typo.h5">Create new picture set</MudText>
                    </TitleContent>
                    <ChildContent>
                        <MudStack>
                            <MudStack Row="true" AlignItems="AlignItems.Center" Class="d-flex">
                                <MudText Typo="Typo.h6">Name</MudText>
                                <MudTextField @bind-Value="Name" MaxLength="200" Label="Name" Variant="Variant.Outlined"
                                              Class="flex-1" TextUpdateSuppression="false" Immediate="true">
                                    Name
                                </MudTextField>
                                <MudSpacer/>
                                <MudSpacer/>
                            </MudStack>
                            <MudStack Row="true" AlignItems="AlignItems.Center">
                                <MudButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Large"
                                           EndIcon="@Icons.Material.Outlined.Add" OnClick="@CreatePictureSet"
                                           Disabled="_pictureSet != null || Name.Trim().Length == 0">
                                    Create
                                </MudButton>
                                <MudButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Large"
                                           EndIcon="@Icons.Material.Outlined.Save" OnClick="@UpdatePictureSet"
                                           Disabled="_pictureSet == null || Name.Trim().Length == 0">
                                    Update
                                </MudButton>
                            </MudStack>
                        </MudStack>
                    </ChildContent>
                </MudExpansionPanel>
                <GetAliveTab SharedState="_sharedState"/>
                @if (_pictureSet is not { IsDone: true })
                {
                    <NtpSyncTab SharedState="_sharedState"/>
                    <SyncFramesTab SharedState="_sharedState"/>
                    <SoundTab SharedState="_sharedState"/>
                }
                <PictureTakeSet PictureRequestType="PictureRequestType.StandingSpread"
                                PictureRequestModel="PictureRequestStandingSpread"
                                PictureSetUId="_pictureSet?.Uuid"
                                Disabled="_pictureSet == null || _pictureSet.IsDone || !Alived || !NtpSynced || !SyncedFrames || AliveCount == 0 || AnyActive"
                                Finished="_pictureSet is { IsDone: true}"/>
                <PictureTakeSet PictureRequestType="PictureRequestType.StandingTogether"
                                PictureRequestModel="PictureRequestStandingTogether"
                                PictureSetUId="_pictureSet?.Uuid"
                                Disabled="_pictureSet == null || _pictureSet.IsDone || !Alived || !NtpSynced || !SyncedFrames || AliveCount == 0 || AnyActive"
                                Finished="_pictureSet is { IsDone: true}"/>
                <PictureTakeSet PictureRequestType="PictureRequestType.Sitting"
                                PictureRequestModel="PictureRequestSitting"
                                PictureSetUId="_pictureSet?.Uuid"
                                Disabled="_pictureSet == null || _pictureSet.IsDone || !Alived || !NtpSynced || !SyncedFrames || AliveCount == 0 || AnyActive"
                                Finished="_pictureSet is { IsDone: true}"/>
                <ActionsTab SharedState="_sharedState"/>
                <CancelTab/>
            </MudStack>
        </MudExpansionPanels>
    </MudStack>
</DefaultPage>
