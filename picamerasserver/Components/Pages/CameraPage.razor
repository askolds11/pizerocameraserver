@page "/camera"
@using picamerasserver.Components.Components
@using picamerasserver.pizerocamera.Requests

<DefaultPage>
    <MudStack Style="width: 100%">
        <MudExpansionPanels Elevation="5" MultiExpansion>
            <MudExpansionPanel Expanded Gutters="false" Dense="true">
                <TitleContent>
                    <MudText Typo="Typo.h5">Status</MudText>
                </TitleContent>
                <ChildContent>
                    <StatusTable ColorTransform="@ColorTransform"></StatusTable>
                </ChildContent>
            </MudExpansionPanel>
            <MudExpansionPanel Expanded>
                <TitleContent>
                    <MudText Typo="Typo.h5">Take picture</MudText>
                    <MudButton Variant="Variant.Filled" Color="Color.Primary"
                               OnClick="@TakePicture">
                        Take pic
                    </MudButton>
                    <MudButton Variant="Variant.Filled" Color="Color.Primary"
                               OnClick="@SendPicture">
                        Send pic
                    </MudButton>
                    <MudButton Variant="Variant.Filled" Color="Color.Primary"
                               OnClick="@(() => OnSwitchMode(new CameraRequest.StartPreview()))">
                        Start preview
                    </MudButton>
                    <MudButton Variant="Variant.Filled" Color="Color.Primary"
                               OnClick="@(() => OnSwitchMode(new CameraRequest.StopPreview()))">
                        Stop preview
                    </MudButton>
                </TitleContent>
                <ChildContent>
                    <MudDataGrid @ref="_gridData" T="PictureElement" ServerData="ServerReload" Filterable="false" SortMode="SortMode.None">
                        @* <ToolBarContent> *@
                        @*     <MudText Typo="Typo.h6">Pictures</MudText> *@
                        @* </ToolBarContent> *@
                        <Columns>
                            <PropertyColumn Property="x => x.Uuid" Title="Uuid" />
                            <PropertyColumn Property="x => x.RequestTime" Title="Request time"/>
                            <TemplateColumn Title="Taken">
                                <CellTemplate>
                                    <MudStack Row>
                                        @context.Item.TakenCount / @context.Item.TotalCount
                                    </MudStack>
                                </CellTemplate>
                            </TemplateColumn>
                            <TemplateColumn Title="Sent">
                                <CellTemplate>
                                    <MudStack Row>
                                        @context.Item.SentCount / @context.Item.TakenCount
                                    </MudStack>
                                </CellTemplate>
                            </TemplateColumn>
                            <TemplateColumn Title="Actions" CellClass="pa-0 ma-0">
                                <CellTemplate>
                                    <MudStack Row>
                                        <MudIconButton Href="@($"downloadpictures/{context.Item.Uuid}")" Target="_blank" Icon="@Icons.Material.Rounded.Download" aria-label="download" Size="Size.Medium" Class="pa-4 ma-0" />
                                    </MudStack>
                                </CellTemplate>
                            </TemplateColumn>
                        </Columns>
                        <PagerContent>
                            <MudDataGridPager T="PictureElement" />
                        </PagerContent>
                    </MudDataGrid>
                </ChildContent>
            </MudExpansionPanel>
            <MudExpansionPanel Expanded>
                <TitleContent>
                    <MudText Typo="Typo.h5">Config</MudText>
                </TitleContent>
                <ChildContent>
                    <ControlsControl />
                    
                    <MudButton Variant="Variant.Filled" Color="Color.Primary"
                               OnClick="@(() => OnSubmitConfig())">
                        Set controls
                    </MudButton>
                    <MudButton Variant="Variant.Filled" Color="Color.Primary"
                               OnClick="@(() => OnGetConfig())">
                        Set controls
                    </MudButton>
                </ChildContent>
            </MudExpansionPanel>
            <MudExpansionPanel>
                <TitleContent>
                    <MudText Typo="Typo.h5">Preview</MudText>
                </TitleContent>
                <ChildContent>
                    <MudImage Src="@($"http://pizero.local:8000/stream.mjpg")" Alt="Here's Johnny" Elevation="25"
                              Class="rounded-lg ma-4"
                              ObjectFit="ObjectFit.Contain" Fluid="true"/>
                </ChildContent>
            </MudExpansionPanel>
        </MudExpansionPanels>
    </MudStack>
</DefaultPage>